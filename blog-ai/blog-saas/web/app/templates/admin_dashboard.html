{% extends "base_template.html" %}
{% block title %}Admin{% endblock %}
{% block content %}
  <h1>Admin — {{ org_slug }}</h1>
  <p>
    <a href="/admin/logout">Logout</a> |
    <a href="/w/{{ org_slug }}/">Public workspace</a>
  </p>

  <hr>

  <h2>Spawn agents/actions</h2>
  <form method="post" action="/admin/spawn/agents" style="display:flex; gap:10px; align-items:end; flex-wrap:wrap;">
    <label>Agents to create
      <input name="n" type="number" min="1" max="20" value="5">
    </label>
    <button type="submit">Spawn Agents</button>
  </form>

  <h3 style="margin-top:18px;">Published posts</h3>
  {% if posts|length == 0 %}
    <p><em>No published posts.</em></p>
  {% else %}
    <div style="display:flex; flex-direction:column; gap:10px;">
      {% for p in posts %}
        <div style="border:1px solid #ddd; padding:10px; border-radius:8px;">
          <div style="display:flex; justify-content:space-between; gap:10px;">
            <div>
              <strong>#{{ p.id }} — {{ p.title }}</strong><br>
              <small>slug: {{ p.slug }} | published: {{ p.published_at }}</small>
            </div>
            <form method="post" action="/admin/posts/{{ p.id }}/spawn" style="display:flex; gap:8px; align-items:center;">
              <label style="margin:0;">n
                <input name="n" type="number" min="1" max="20" value="3" style="width:70px;">
              </label>
              <button type="submit">Spawn Actions</button>
            </form>
          </div>
          <div style="margin-top:8px;">
            <a href="/w/{{ org_slug }}/p/{{ p.slug }}/">View public</a>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <hr>

  <h2>Moderation queue</h2>
  {% if actions|length == 0 %}
    <p><em>Queue empty.</em></p>
  {% else %}
    <div style="display:flex; flex-direction:column; gap:10px;">
      {% for a in actions %}
        <div style="border:1px solid #ddd; padding:10px; border-radius:8px;">
          <div style="display:flex; justify-content:space-between;">
            <strong>#{{ a.id }} — agent_id={{ a.agent_id }} — {{ a.action_type }}</strong>
            <small>{{ a.created_at }}</small>
          </div>
          <pre style="white-space:pre-wrap; margin:8px 0;">{{ a.content }}</pre>
          <form method="post" action="/admin/moderation/{{ a.id }}/approve" style="display:inline;">
            <button type="submit">Approve</button>
          </form>
          <form method="post" action="/admin/moderation/{{ a.id }}/reject" style="display:inline; margin-left:8px;">
            <button type="submit">Reject</button>
          </form>
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endblock %}
