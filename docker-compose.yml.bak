services:
  # ... (postgres y backend quedan igual)

  worker:
    build:
              context: ./
              dockerfile: ./core/Dockerfile
          context: ./
          dockerfile: ./core/Dockerfile
    # COMANDO CORREGIDO: Ejecuta el worker.py directamente. 
    # worker.py contiene la función worker_loop() interna.
    command: ["python", "app/worker.py", "0.5"] # El '0.5' es el poll_seconds
    
    environment:
      DATABASE_URL: postgresql+psycopg2://forge:forge@postgres:5432/forge
      DEBUG: "true"
    depends_on:
      postgres:
        condition: service_healthy # Esperamos a que la DB esté lista
    restart: unless-stopped
    volumes:
      # MUY IMPORTANTE: El worker DEBE tener acceso a 'generated' 
      # porque los agentes escriben sus resultados ahí.
      - ./backend/generated:/app/generated 
      
# ... (ui y volumes quedan igual)
