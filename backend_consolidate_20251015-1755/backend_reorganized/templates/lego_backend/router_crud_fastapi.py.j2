"""
Auto-generated FastAPI CRUD router for {{ model_class_name }}.

Generated from lego_backend/router_crud_fastapi.py.j2.
"""

from typing import List

from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.orm import Session

from core.database.database import get_db
from {{ schemas_module }} import (
    {{ schema_create_name }},
    {{ schema_update_name }},
    {{ schema_read_name }},
)
from {{ service_module }} import (
    get_{{ resource_name }},
    list_{{ resource_name_plural }},
    create_{{ resource_name }},
    update_{{ resource_name }},
    delete_{{ resource_name }},
)


router = APIRouter(
    prefix="{{ api_prefix }}",
    tags=["{{ api_tag }}"],
)


@router.get("/", response_model=List[{{ schema_read_name }}])
def list_{{ resource_name_plural }}_endpoint(
    skip: int = 0,
    limit: int = 100,
    db: Session = Depends(get_db),
):
    return list_{{ resource_name_plural }}(db=db, skip=skip, limit=limit)


@router.get("/{ {{ pk_name }} }", response_model={{ schema_read_name }})
def get_{{ resource_name }}_endpoint(
    {{ pk_name }}: int,
    db: Session = Depends(get_db),
):
    obj = get_{{ resource_name }}(db=db, {{ pk_name }}={{ pk_name }})
    if not obj:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail="{{ model_class_name }} not found",
        )
    return obj


@router.post("/", response_model={{ schema_read_name }}, status_code=status.HTTP_201_CREATED)
def create_{{ resource_name }}_endpoint(
    payload: {{ schema_create_name }},
    db: Session = Depends(get_db),
):
    return create_{{ resource_name }}(db=db, data=payload)


@router.put("/{ {{ pk_name }} }", response_model={{ schema_read_name }})
def update_{{ resource_name }}_endpoint(
    {{ pk_name }}: int,
    payload: {{ schema_update_name }},
    db: Session = Depends(get_db),
):
    obj = update_{{ resource_name }}(db=db, {{ pk_name }}={{ pk_name }}, data=payload)
    if not obj:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail="{{ model_class_name }} not found",
        )
    return obj


@router.delete("/{ {{ pk_name }} }", status_code=status.HTTP_204_NO_CONTENT)
def delete_{{ resource_name }}_endpoint(
    {{ pk_name }}: int,
    db: Session = Depends(get_db),
):
    ok = delete_{{ resource_name }}(db=db, {{ pk_name }}={{ pk_name }})
    if not ok:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail="{{ model_class_name }} not found",
        )
    return None
