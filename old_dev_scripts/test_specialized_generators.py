#!/usr/bin/env python3
"""
Test para los generadores especializados
"""

import sys
import os
import shutil

sys.path.append(os.path.dirname(os.path.abspath(__file__)))

def test_nextjs_generator():
    """Test del generador Next.js"""
    print("üß™ TEST: Generador Next.js")
    
    try:
        from generators.specialized.nextjs_generator import NextJSGenerator
        
        generator = NextJSGenerator()
        result = generator.generate(
            project_name="Test NextJS App",
            description="Una aplicaci√≥n Next.js de prueba con caracter√≠sticas avanzadas",
            features=["auth", "payment", "admin_panel"],
            technologies=["react", "typescript", "tailwind"]
        )
        
        if result.get("success"):
            print("‚úÖ NextJS Generator: FUNCIONA")
            print(f"   Ruta: {result.get('project_path')}")
            
            # Verificar archivos generados
            project_path = result.get('project_path')
            expected_files = [
                "package.json",
                "next.config.js", 
                "app/layout.tsx",
                "app/page.tsx"
            ]
            
            for file in expected_files:
                file_path = os.path.join(project_path, file)
                if os.path.exists(file_path):
                    print(f"   ‚úÖ {file}: EXISTE")
                else:
                    print(f"   ‚ùå {file}: NO EXISTE")
            
            return True
        else:
            print(f"‚ùå NextJS Generator: {result.get('error')}")
            return False
            
    except Exception as e:
        print(f"‚ùå NextJS Generator Error: {e}")
        return False

def test_fastapi_generator():
    """Test del generador FastAPI"""
    print("\nüß™ TEST: Generador FastAPI")
    
    try:
        from generators.specialized.fastapi_generator import FastAPIGenerator
        
        generator = FastAPIGenerator()
        result = generator.generate(
            project_name="Test FastAPI Service",
            description="Un servicio FastAPI de prueba con autenticaci√≥n",
            features=["auth", "payment"],
            technologies=["python", "postgresql"]
        )
        
        if result.get("success"):
            print("‚úÖ FastAPI Generator: FUNCIONA")
            print(f"   Ruta: {result.get('project_path')}")
            
            # Verificar archivos generados
            project_path = result.get('project_path')
            expected_files = [
                "requirements.txt",
                "app/main.py",
                "app/api/__init__.py",
                "Dockerfile"
            ]
            
            for file in expected_files:
                file_path = os.path.join(project_path, file)
                if os.path.exists(file_path):
                    print(f"   ‚úÖ {file}: EXISTE")
                else:
                    print(f"   ‚ùå {file}: NO EXISTE")
            
            return True
        else:
            print(f"‚ùå FastAPI Generator: {result.get('error')}")
            return False
            
    except Exception as e:
        print(f"‚ùå FastAPI Generator Error: {e}")
        return False

def main():
    """Ejecutar tests de generadores"""
    print("üöÄ TESTEANDO GENERADORES ESPECIALIZADOS")
    print("=" * 50)
    
    # Limpiar proyectos de prueba anteriores
    test_dirs = [
        "generated_projects/Test NextJS App",
        "generated_projects/Test FastAPI Service"
    ]
    
    for test_dir in test_dirs:
        if os.path.exists(test_dir):
            shutil.rmtree(test_dir)
    
    tests = [test_nextjs_generator, test_fastapi_generator]
    results = []
    
    for test in tests:
        try:
            result = test()
            results.append(result)
        except Exception as e:
            print(f"‚ùå Test {test.__name__} fall√≥: {e}")
            results.append(False)
    
    # Resumen
    print("\n" + "=" * 50)
    print("üìä RESULTADOS GENERADORES ESPECIALIZADOS:")
    
    passed = sum(results)
    total = len(results)
    
    for i, (test, result) in enumerate(zip(tests, results), 1):
        status = "‚úÖ PAS√ì" if result else "‚ùå FALL√ì"
        print(f"   {i}. {test.__name__}: {status}")
    
    print(f"\nüéØ {passed}/{total} generadores funcionando")
    
    if passed == total:
        print("üéâ ¬°TODOS LOS GENERADORES ESPECIALIZADOS FUNCIONAN!")
        print("\nüöÄ Ahora tu Forge SaaS puede generar:")
        print("   - Aplicaciones Next.js con TypeScript y Tailwind")
        print("   - Servicios FastAPI con autenticaci√≥n y base de datos")
        print("   - ¬°Y mucho m√°s que lovable.dev!")
    else:
        print("‚ö†Ô∏è  Algunos generadores necesitan ajustes")

if __name__ == "__main__":
    main()
