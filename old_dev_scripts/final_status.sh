#!/bin/bash
echo "=== SCOUTA/FORGE - ESTADO FINAL ==="
echo ""

echo "üê≥ CONTENEDORES ACTIVOS:"
docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"

echo ""
echo "üåê BACKEND API:"
if curl -s http://localhost:8000/api/health > /dev/null; then
    echo "‚úÖ Backend respondiendo"
    curl -s http://localhost:8000/api/health
else
    echo "‚ùå Backend no responde"
fi

echo ""
echo "ü§ñ WORKER STATUS:"
if docker ps | grep -q worker-simple; then
    echo "‚úÖ Worker activo"
    docker logs worker-simple --tail=3 2>/dev/null || echo "Worker sin logs recientes"
else
    echo "‚ùå Worker no activo"
fi

echo ""
echo "üìä DATABASE:"
docker compose exec postgres psql -U forge -d forge -c "
SELECT 
  (SELECT COUNT(*) FROM projects) as projects,
  (SELECT COUNT(*) FROM jobs WHERE state = 'queued') as queued_jobs,
  (SELECT COUNT(*) FROM jobs WHERE state = 'done') as completed_jobs,
  (SELECT COUNT(*) FROM agent_runs) as total_runs;
"
