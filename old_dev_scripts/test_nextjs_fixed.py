#!/usr/bin/env python3
"""
Test espec√≠fico para NextJS Generator corregido
"""

import sys
import os
import shutil

sys.path.append(os.path.dirname(os.path.abspath(__file__)))

def test_nextjs_generator_fixed():
    """Test del generador Next.js corregido"""
    print("üß™ TEST: Generador Next.js (Corregido)")
    
    try:
        from generators.specialized.nextjs_generator import NextJSGenerator
        
        # Limpiar directorio de prueba
        test_dir = "generated_projects/Test NextJS Fixed"
        if os.path.exists(test_dir):
            shutil.rmtree(test_dir)
        
        generator = NextJSGenerator()
        result = generator.generate(
            project_name="Test NextJS Fixed",
            description="Una aplicaci√≥n Next.js de prueba CORREGIDA",
            features=["auth", "payment"],
            technologies=["react", "typescript", "tailwind"]
        )
        
        if result.get("success"):
            print("‚úÖ NextJS Generator: FUNCIONA")
            print(f"   Ruta: {result.get('project_path')}")
            
            # Verificar archivos generados
            project_path = result.get('project_path')
            expected_files = [
                "package.json",
                "next.config.js", 
                "app/layout.tsx",
                "app/page.tsx",
                "app/globals.css"
            ]
            
            for file in expected_files:
                file_path = os.path.join(project_path, file)
                if os.path.exists(file_path):
                    size = os.path.getsize(file_path)
                    print(f"   ‚úÖ {file}: EXISTE ({size} bytes)")
                    
                    # Mostrar primeras l√≠neas de archivos clave
                    if file in ["package.json", "next.config.js"]:
                        with open(file_path, 'r') as f:
                            content = f.read()
                            print(f"      Contenido: {content[:100]}...")
                else:
                    print(f"   ‚ùå {file}: NO EXISTE")
            
            return True
        else:
            print(f"‚ùå NextJS Generator: {result.get('error')}")
            return False
            
    except Exception as e:
        print(f"‚ùå NextJS Generator Error: {e}")
        import traceback
        traceback.print_exc()
        return False

if __name__ == "__main__":
    test_nextjs_generator_fixed()
